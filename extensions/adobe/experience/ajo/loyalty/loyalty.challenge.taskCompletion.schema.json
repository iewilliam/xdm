{
  "meta:license": [
    "Copyright 2025 Adobe Systems Incorporated. All rights reserved.",
    "This work is licensed under a Creative Commons Attribution 4.0 International (CC BY 4.0) license",
    "you may not use this file except in compliance with the License. You may obtain a copy",
    "of the License at https://creativecommons.org/licenses/by/4.0/"
  ],
  "$id": "https://ns.adobe.com/experience/ajo/loyalty/challenge/taskCompletion",
  "$schema": "http://json-schema.org/draft-06/schema#",
  "title": "Loyalty Challenge Task Completion",
  "description": "Details about task completion records within a loyalty challenge's task, including completion date, accumulated values, item-level tracking, and completion attempt history.",
  "type": "object",
  "meta:extensible": true,
  "definitions": {
    "taskCompletion": {
      "properties": {
        "xdm:completionDate": {
          "title": "Completion Date",
          "type": "string",
          "format": "date-time",
          "description": "Date and time when the task was completed."
        },
        "xdm:accumulators": {
          "title": "Accumulators",
          "type": "object",
          "description": "Aggregated and item-level values that contributed to this task completion.",
          "properties": {
            "xdm:qty": {
              "title": "Quantity",
              "type": "number",
              "description": "Total quantity accumulated for this task completion."
            },
            "xdm:spend": {
              "title": "Spend",
              "type": "number",
              "description": "Total spend accumulated for this task completion."
            },
            "xdm:itemList": {
              "title": "Item List",
              "type": "array",
              "description": "Item-level entries that contributed to this completion.",
              "items": {
                "type": "object",
                "properties": {
                  "xdm:item": {
                    "title": "Item",
                    "type": "object",
                    "description": "Item details for this accumulator entry.",
                    "properties": {
                      "xdm:itemSet": {
                        "title": "Item Set",
                        "type": "array",
                        "description": "Properties/tags of the item (e.g. product codes).",
                        "uniqueItems": true,
                        "items": { "type": "string", "minLength": 1 }
                      },
                      "xdm:itemName": {
                        "title": "Item Name",
                        "type": "string",
                        "description": "The name of the item.",
                        "minLength": 1
                      },
                      "xdm:quantity": {
                        "title": "Quantity",
                        "type": "number",
                        "description": "The quantity of the item."
                      },
                      "xdm:unitPrice": {
                        "title": "Unit Price",
                        "type": "number",
                        "description": "The price per unit of the item."
                      },
                      "xdm:subTotal": {
                        "title": "Sub Total",
                        "type": "number",
                        "description": "The line-level total for this item."
                      }
                    }
                  },
                  "xdm:id": {
                    "title": "ID",
                    "type": "string",
                    "description": "Unique identifier for this accumulator entry.",
                    "minLength": 1
                  },
                  "xdm:timestamp": {
                    "title": "Timestamp",
                    "type": "string",
                    "format": "date-time",
                    "description": "Timestamp of the qualified event."
                  },
                  "xdm:timestampApplied": {
                    "title": "Timestamp Applied",
                    "type": "string",
                    "format": "date-time",
                    "description": "When this entry was applied to the task completion."
                  },
                  "xdm:utcOffset": {
                    "title": "UTC Offset",
                    "type": "string",
                    "description": "Timezone offset at time of event (e.g. -08:00)."
                  },
                  "xdm:locationId": {
                    "title": "Location ID",
                    "type": "string",
                    "description": "Identifier for the location where the transaction occurred."
                  },
                  "xdm:transactionId": {
                    "title": "Transaction ID",
                    "type": "string",
                    "description": "Unique identifier for the transaction.",
                    "minLength": 1
                  }
                }
              }
            }
          }
        },
        "xdm:completionAttemptList": {
          "title": "Completion Attempt List",
          "type": "array",
          "description": "History of completion attempts (e.g. reward issuance attempts).",
          "items": {
            "type": "object",
            "properties": {
              "xdm:date": {
                "title": "Date",
                "type": "string",
                "format": "date-time",
                "description": "When this completion attempt occurred."
              },
              "xdm:message": {
                "title": "Message",
                "type": "string",
                "description": "Message or reason associated with this attempt (e.g. reward not provided)."
              },
              "xdm:millis": {
                "title": "Milliseconds",
                "type": "number",
                "description": "Duration or offset in milliseconds for this attempt."
              }
            }
          }
        }
      }
    }
  },
  "allOf": [
    { "$ref": "https://ns.adobe.com/xdm/common/extensible#/definitions/@context" },
    { "$ref": "#/definitions/taskCompletion" }
  ],
  "meta:status": "experimental"
}
